# Additional Makefile targets for 10-participant testing
# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ Makefile –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
.PHONY: seed-10-participants
seed-10-participants:
	@echo "üå± –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤..."
	@python3 scripts/seed_10_participants.py

# –ó–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∞ —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ (—Ç–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
.PHONY: test-10-quick
test-10-quick:
	@echo "‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏..."
	@python3 scripts/test_10_participants.py

# –ó–∞–ø—É—Å–∫ –ø–æ–ª–Ω–æ–≥–æ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
.PHONY: test-10-comprehensive
test-10-comprehensive:
	@echo "üß™ –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏..."
	@chmod +x scripts/test_10_participants.sh
	@./scripts/test_10_participants.sh

# –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –ø–æ–ª–Ω–æ–π —Å—Ä–µ–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
.PHONY: setup-10-test-env
setup-10-test-env: anvil deploy backend seed-10-participants
	@echo "üöÄ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≥–æ—Ç–æ–≤–∞!"
	@echo "üìù –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–º–æ—â—å—é: make test-10-comprehensive"

# –û—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
.PHONY: reset-10-test-env
reset-10-test-env:
	@echo "üîÑ –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã..."
	@docker-compose down
	@docker-compose up -d anvil
	@sleep 5
	@make deploy
	@make backend &
	@sleep 10
	@make seed-10-participants
	@echo "‚úÖ –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ä–µ–¥–∞ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∞"

# –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ Python —Ç–µ—Å—Ç–æ–≤ –¥–ª—è 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
.PHONY: test-10-python
test-10-python:
	@echo "üêç Python —Ç–µ—Å—Ç—ã –¥–ª—è 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤..."
	@python3 scripts/test_10_participants.py

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
.PHONY: test-10-performance
test-10-performance:
	@echo "‚ö° –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏..."
	@python3 -c "
import asyncio
import aiohttp
import time
import statistics

async def performance_test():
    start_time = time.time()
    tasks = []
    
    async with aiohttp.ClientSession() as session:
        # 50 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
        for i in range(50):
            tasks.append(session.get('http://localhost:8000/api/v1/projects'))
        
        responses = await asyncio.gather(*tasks, return_exceptions=True)
        
    end_time = time.time()
    duration = end_time - start_time
    
    successful = sum(1 for r in responses if hasattr(r, 'status') and r.status == 200)
    
    print(f'üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: {successful}/50 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ {duration:.2f} —Å–µ–∫—É–Ω–¥')
    print(f'üìä –°–∫–æ—Ä–æ—Å—Ç—å: {successful/duration:.1f} –∑–∞–ø—Ä–æ—Å–æ–≤/—Å–µ–∫')

asyncio.run(performance_test())
"

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
.PHONY: test-10-report
test-10-report:
	@echo "üìã –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏..."
	@echo "=== –û–¢–ß–ï–¢ –û –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ò 10 –£–ß–ê–°–¢–ù–ò–ö–û–í ===" > test_report.txt
	@echo "–î–∞—Ç–∞: $$(date)" >> test_report.txt
	@echo "" >> test_report.txt
	@echo "1. –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤:" >> test_report.txt
	@curl -s http://localhost:8000/health | jq -r '"   Backend: " + .status' >> test_report.txt || echo "   Backend: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >> test_report.txt
	@curl -s http://localhost:8545 > /dev/null 2>&1 && echo "   Anvil: –¥–æ—Å—Ç—É–ø–µ–Ω" >> test_report.txt || echo "   Anvil: –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω" >> test_report.txt
	@echo "" >> test_report.txt
	@echo "2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö:" >> test_report.txt
	@curl -s http://localhost:8000/api/v1/treasury/stats | jq -r '"   –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: " + (.total_balance | tostring) + " ETH"' >> test_report.txt || echo "   –î–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã" >> test_report.txt
	@curl -s http://localhost:8000/api/v1/projects | jq -r '"   –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤: " + (length | tostring)' >> test_report.txt || echo "   –ü—Ä–æ–µ–∫—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã" >> test_report.txt
	@echo "" >> test_report.txt
	@echo "‚úÖ –û—Ç—á–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ test_report.txt"

# –ü–æ–º–æ—â—å –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏
.PHONY: help-10-testing
help-10-testing:
	@echo "üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –° 10 –£–ß–ê–°–¢–ù–ò–ö–ê–ú–ò"
	@echo "================================"
	@echo ""
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  make setup-10-test-env      - –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –ø–æ–ª–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É"
	@echo "  make seed-10-participants   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è 10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"
	@echo "  make test-10-quick          - –ë—ã—Å—Ç—Ä–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
	@echo "  make test-10-comprehensive  - –ü–æ–ª–Ω–æ–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
	@echo "  make test-10-python         - –¢–æ–ª—å–∫–æ Python —Ç–µ—Å—Ç—ã"
	@echo "  make test-10-performance    - –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"
	@echo "  make test-10-report         - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞"
	@echo "  make reset-10-test-env      - –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ä–µ–¥—É"
	@echo ""
	@echo "–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:"
	@echo "  1. make setup-10-test-env"
	@echo "  2. make test-10-comprehensive"
	@echo "  3. make test-10-report"
	@echo ""
	@echo "–î–ª—è –æ—Ç–ª–∞–¥–∫–∏:"
	@echo "  make test-10-quick          - –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞"
	@echo "  make test-10-performance    - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏"

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã
.PHONY: monitor-10-test
monitor-10-test:
	@echo "üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã —Å 10 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏..."
	@echo "================================================"
	@echo ""
	@echo "üè• –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤:"
	@curl -s http://localhost:8000/health && echo "" || echo "‚ùå Backend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
	@curl -s http://localhost:8545 > /dev/null 2>&1 && echo "‚úÖ Anvil –¥–æ—Å—Ç—É–ø–µ–Ω" || echo "‚ùå Anvil –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
	@curl -s http://localhost:3000 > /dev/null 2>&1 && echo "‚úÖ Frontend –¥–æ—Å—Ç—É–ø–µ–Ω" || echo "‚ö†Ô∏è Frontend –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
	@echo ""
	@echo "üí∞ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ Treasury:"
	@curl -s http://localhost:8000/api/v1/treasury/stats | jq '.' 2>/dev/null || echo "‚ùå –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
	@echo ""
	@echo "üìã –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–µ–∫—Ç–æ–≤:"
	@curl -s http://localhost:8000/api/v1/projects | jq 'length' 2>/dev/null || echo "‚ùå –ü—Ä–æ–µ–∫—Ç—ã –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã"
	@echo ""
	@echo "üó≥Ô∏è –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:"
	@curl -s http://localhost:8000/api/v1/votes/current-round | jq '.' 2>/dev/null || echo "‚ùå –ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ"